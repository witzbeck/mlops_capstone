FROM ghcr.io/mlflow/mlflow:v2.12.2

RUN pip3 install --user --no-cache-dir psycopg sqlalchemy
RUN pip3 install --no-cache-dir psycopg sqlalchemy

# ARG POSTGRES_HOST
# ARG POSTGRES_PORT
# ARG MLFLOW_EXPERIMENT_NAME
# ARG MLFLOW_ARTIFACT_URI
# ARG MLFLOW_TRACKING_URI
# ARG MLFLOW_TRACKING_HOST
# ARG MLFLOW_TRACKING_PORT
# ARG MLFLOW_TRACKING_NAME
# ARG MLFLOW_TRACKING_USER
# ARG MLFLOW_TRACKING_PASSWORD
# ARG MLFLOW_STORE_URI

# Set the environment variables
# ENV POSTGRES_HOST=$POSTGRES_HOST
# ENV POSTGRES_PORT=$POSTGRES_PORT
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD

ENV MLFLOW_EXPERIMENT_NAME=$MLFLOW_EXPERIMENT_NAME
ENV MLFLOW_ARTIFACT_URI=$MLFLOW_ARTIFACT_URI
ENV MLFLOW_TRACKING_URI=$MLFLOW_TRACKING_URI

ENV MLFLOW_TRACKING_HOST=$MLFLOW_TRACKING_HOST
ENV MLFLOW_TRACKING_PORT=$MLFLOW_TRACKING_PORT
ENV MLFLOW_TRACKING_NAME=$MLFLOW_TRACKING_NAME
ENV MLFLOW_TRACKING_USER=$MLFLOW_TRACKING_USER
ENV MLFLOW_TRACKING_PASSWORD=$MLFLOW_TRACKING_PASSWORD
ENV MLFLOW_STORE_URI=$MLFLOW_STORE_URI

# Set the working directory
RUN ls -la && sleep 10
WORKDIR /mlflow
RUN ls -la && sleep 10
